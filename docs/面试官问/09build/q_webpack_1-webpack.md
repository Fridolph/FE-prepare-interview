# Webpack

## Webpack 是什么

::: details
webpack 是一个模块打包器。webpack 的主要目标是将 JavaScript 文件打包在一起，打包后的文件用于在浏览器中使用，但它也能够胜任转换(transform)、打包(bundle)。

:::

## 说一下 webpack 的构建流程

::: details Webpack 的运⾏流程是⼀个`串⾏`的过程，从启动到结束会`依次执⾏`以下流程：

1. **初始化参数**：解析 webpack 配置参数，合并 shell 传入和 webpack.config.js 文件配置的参数，形成最后的配置结果。
2. **开始编译**：上一步得到的参数初始化`compiler`对象，注册所有配置的插件，插件监听 webpack 构建生命周期的事件节点，做出相应的反应，执行对象的 run 方法开始执行编译。
3. **确定入口**：从配置的`entry`入口，开始`解析文件`构建 AST 语法树，`找出依赖`，`递归`下去。
4. **编译模块**：递归中根据`文件类型`和`loader配置`，调用所有配置的 loader 对`文件转换`，再找出该`模块依赖`的模块，再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。
5. **完成模块编译**：在经过第 4 步使⽤ Loader 翻译完所有模块后，得到了每个模块被翻译后的`最终内容`以`及它们之间的依赖关系`；
6. **输出资源**：根据⼊⼝和模块之间的依赖关系，组装成⼀个个包含多个模块的 `Chunk`，再把每个 Chunk 转换成⼀个单独的⽂件加⼊到输出列表，这步是可以修改输出内容的最后机会；
7. **输出完成**：在确定好输出内容后，根据配置确定输出的路径和⽂件名，把⽂件内容`写⼊到⽂件`系统。
   :::

## 其他

### Webpack / Vite / Rollup 的区别？ 还知道哪些打包工具，它们的区别

::: details
|特性|Webpack|Vite|
|-|-|-|
|启动速速|慢|快|
|底层原理|原生 JS，相对 Vite 慢上不少|基于 ESbuild（go 语言）进行预构建|
|热更新|慢，需将依赖重新编译|快，模块改变，重新请求模块|
|打包速度|相对慢|相对快|
|打包体积|小，利用 rollup 进行打包，支持 Tree Shaking 和 ESM|需手动优化来进行压缩和 Tree Shaking|
|配置难度|大，可能用到脚手架|开箱即用，有默认优化配置|
|兼容性|良好|因支持 ESM，低版本浏览器兼容较差|
|生态对比|活跃度高，社区丰富|新工具，版本更新较快，稳定性稍逊|

- 启动速度：Webpack 因为要先进行本地打包启动服务器后再去请求对应资源，导致启动时间稍长；而 Vite 不用像 Webpack 那样分析模块依赖，进行编译等操作，Vite 直接启了一个开发服务器，然后按需编译（得益于现代浏览器本身支持 ES Module）

- 底层原理：Webpack 使用原生 JS 进行代码编写，编译上不占优势；而 Vite 基于 esbuild 进行预构建，速度只有 webpack 的 2%-3%；esbuild 用 go 写的，速度比 js 写的快 10-100 倍，go（纳秒级）语言本身相对 js（毫秒级）来说就有很大的优势

:::

### Vite 和 Webpack 在热更新上的区别
 
::: details
|特点|Vite|Webpack|
|-|-|-|
|实时热更新|支持模块级别的热更新，即只更新修改的模块，无需刷新整个页面|支持文件级别的热更新，修改任何文件都会触发整个应用的重新构建和刷新|
|构建速度|在开发环境下，利用浏览器原生的模块导入功能，不需要进行打包构建，启动速度更快|需要进行打包构建，每次修改代码都需要重新构建和编译，相对较慢|
|开发体验|提供更好的开发体验，修改代码后快速反馈，无需等待全量构建|反馈速度较慢，需要等待每次构建和编译完成|
|适用场景|适用于中小型项目，追求开发效率的前端项目|适用于大型项目，有复杂需求和更多构建优化的前端项目|
:::

## 参考

- [作者：何逸轩 - webpack 系列](https://juejin.cn/post/7140769906080874504)
- [作者：卷起来的小白 - 前端打包工具介绍和对比](https://juejin.cn/post/7113803425145421832)
