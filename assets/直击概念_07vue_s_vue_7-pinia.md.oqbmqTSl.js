import{_ as s,c as i,o as a,V as n}from"./chunks/framework.CMKosmpS.js";const c=JSON.parse('{"title":"pinia","description":"","frontmatter":{},"headers":[],"relativePath":"ç›´å‡»æ¦‚å¿µ/07vue/s_vue_7-pinia.md","filePath":"ç›´å‡»æ¦‚å¿µ/07vue/s_vue_7-pinia.md","lastUpdated":1724141323000}'),p={name:"ç›´å‡»æ¦‚å¿µ/07vue/s_vue_7-pinia.md"},l=n(`<h1 id="pinia" tabindex="-1">pinia <a class="header-anchor" href="#pinia" aria-label="Permalink to &quot;pinia&quot;">â€‹</a></h1><h2 id="æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1">æ ¸å¿ƒæ¦‚å¿µ <a class="header-anchor" href="#æ ¸å¿ƒæ¦‚å¿µ" aria-label="Permalink to &quot;æ ¸å¿ƒæ¦‚å¿µ&quot;">â€‹</a></h2><p>Pinia çš„ç‰¹æ€§ï¼š</p><p>pinia ä¹Ÿå…·æœ‰ stateã€gettersã€actionsï¼Œä½†æ˜¯ç§»é™¤äº† modulesã€mutations ï¼›</p><p>pinia çš„ actions é‡Œé¢å¯ä»¥æ”¯æŒåŒæ­¥ä¹Ÿå¯ä»¥æ”¯æŒå¼‚æ­¥ï¼›</p><p>pinia é‡‡ç”¨æ¨¡å—å¼ç®¡ç†ï¼Œæ¯ä¸ª store éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ç›¸ä¸å½±å“ï¼›</p><p>Pinia ä¸ Vuex ç›¸æ¯”ä¸»è¦åŠŸèƒ½ä¼˜ç‚¹åœ¨äºï¼š</p><p>å…¼å®¹æ”¯æŒ Vue 2.x ä¸ 3.x é¡¹ç›®ï¼› æ›´å‹å¥½çš„ Typescript è¯­æ³•æ”¯æŒï¼› æ¯” Vuex ä½“ç§¯æ›´å°ï¼Œæ„å»ºå‹ç¼©ååªæœ‰ 1KB å·¦å³çš„å¤§å°ï¼› æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ï¼›</p><h2 id="é‡ç‚¹æºç è§£æ" tabindex="-1">é‡ç‚¹æºç è§£æ <a class="header-anchor" href="#é‡ç‚¹æºç è§£æ" aria-label="Permalink to &quot;é‡ç‚¹æºç è§£æ&quot;">â€‹</a></h2><h3 id="createpinia" tabindex="-1">createPinia <a class="header-anchor" href="#createpinia" aria-label="Permalink to &quot;createPinia&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vuejs:pinia/packages/pinia/src/createPinia.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> scope</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effectScope</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scope.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">run</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;&gt;(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Record</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;({}))</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Â·Â·Â· Â·Â·Â·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åœ¨ creatPinia å‡½æ•°çš„æœ€å¼€å§‹åœ°æ–¹æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œé€šè¿‡ effectScope å£°æ˜äº†ä¸€ä¸ª ref çš„å“åº”å¼æ•°æ®ï¼Œå¹¶èµ‹å€¼ç»™äº† state å˜é‡ï¼Œè¿™é‡Œçš„å°†å…¶ç®€å•ç†è§£ä¸ºå£°æ˜äº†ä¸€ä¸ª ref å¹¶èµ‹å€¼ç»™ stateï¼›</p><p>effectScopeï¼šè¿™æ˜¯ä¸€ä¸ª Vue 3.x é«˜é˜¶çš„å“åº”å¼çš„ apiï¼Œèƒ½å¤Ÿå¯¹è¿™ä¸ª effect é‡Œé¢çš„å“åº”å¼å‰¯ä½œç”¨ï¼ˆè®¡ç®—å±æ€§ã€ç›‘å¬å™¨ï¼‰ç»Ÿä¸€è¿›è¡Œæ“ä½œå¤„ç†ï¼Œä¾‹å¦‚è°ƒç”¨ stop åœæ­¢ç›‘å¬æ‹¦æˆªç­‰</p><p><a href="https://cn.vuejs.org/api/reactivity-advanced#effectscope" target="_blank" rel="noreferrer">https://cn.vuejs.org/api/reactivity-advanced#effectscope</a></p><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vuejs:pinia/packages/pinia/src/createPinia.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createPinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Â·Â·Â· Â·Â·Â·</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å®šä¹‰ pinia æ’ä»¶ç›¸å…³çš„å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _p</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;_p&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> toBeInstalled</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PiniaPlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// markRawï¼šæ ‡è®°è¯¥ pinia ä¸ä¼šè¢«å“åº”å¼è½¬æ¢å’Œç›‘å¬</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> markRaw</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    install</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // install: vue.useå®é™…æ‰§è¡Œé€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      setActivePinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pinia) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½®å½“å‰ä½¿ç”¨æ•°æ®ä»“åº“ä¸ºæ ¹ pinia å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isVue2) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // å¦‚æœæ˜¯ vue 2.xï¼Œå…¨å±€æ³¨å†Œå·²ç»åœ¨ PiniaVuePlugin å®Œæˆï¼Œæ‰€ä»¥è¿™æ®µé€»è¾‘å°†è·³è¿‡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pinia._a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è®¾ç½® vue é¡¹ç›®çš„ app å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(piniaSymbol, pinia) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// é€šè¿‡ provide æ¥æ³¨å…¥ pinia å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        app.config.globalProperties.$pinia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pinia </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// åœ¨ vue é¡¹ç›®å½“ä¸­è®¾ç½®å…¨å±€å±æ€§ $pinia</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        toBeInstalled.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">plugin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> _p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(plugin)) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¤„ç†å®‰è£…æœªæ‰§è¡Œçš„ pinia æ’ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        toBeInstalled </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ¸…ç©ºæœªå®‰è£…çš„æ’ä»¶åˆ—è¡¨</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    use</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">plugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // pinia ä½¿ç”¨æ’ä»¶æ—¶å€™è°ƒç”¨æ‰§è¡Œï¼Œå°† pinia æ’ä»¶éƒ½å…ˆå¡åˆ°ä¸€ä¸ª _p çš„æ•°ç»„å½“ä¸­ï¼Œåç»­å†è¿›è¡Œåˆå§‹åŒ–æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">._a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isVue2) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        toBeInstalled.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(plugin)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        _p.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">push</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(plugin)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> this</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _p, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pinia çš„æ’ä»¶</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _a: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Vue é¡¹ç›®çš„ app å®ä¾‹ï¼Œåœ¨ install æ‰§è¡Œæ—¶è®¾ç½®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _e: scope, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pinia çš„ effect ä½œç”¨åŸŸå¯¹è±¡ï¼Œæ¯ä¸ªstoreéƒ½æ˜¯å•ç‹¬çš„scope</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    _s: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StoreGeneric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ä»¥ Map çš„æ•°æ®ç»“æ„å½¢å¼å­˜å‚¨ pinia æ•°æ®ä»“åº“ storeï¼Œç±»ä¼¼ state</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pinia æ•°æ®ä»“åº“ state åˆé›†</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pinia</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><p>æ¥ç€ç»§ç»­åˆ†æä¸‹é¢çš„é€»è¾‘èƒ½çœ‹åˆ°æ–¹æ³•å†…é€šè¿‡ markRaw åˆ›å»ºäº†ä¸€ä¸ªåŒ…å« installã€useã€å“åº”å¼æ•°æ® state å±æ€§çš„ pinia å¯¹è±¡ï¼›å¹¶ä¸”æœ€ç»ˆå°† pinia å¯¹è±¡ä½œä¸º createPinia å‡½æ•°çš„è¿”å›å€¼ã€‚</p><p>è¿™ä¸ª pinia å¯¹è±¡ç»è¿‡ markRaw çš„åŒ…è£…ä¼šè¢« Vue æ ‡è®°ä¸ºä¸ä¼šè½¬åŒ–ä¸ºå“åº”å¼ï¼›èƒ½å¤ŸèŠ‚çº¦å†…å­˜çš„ä½¿ç”¨ï¼Œæé«˜è¿è¡Œæ•ˆç‡ã€‚</p><h3 id="definestore" tabindex="-1">defineStore <a class="header-anchor" href="#definestore" aria-label="Permalink to &quot;defineStore&quot;">â€‹</a></h3><p>æ•°æ®ä»“åº“çš„åˆå§‹åŒ–</p><p>defineStore è¯¥æ–¹æ³•åœ¨ä¸Šé¢ â€œåŸºç¡€ä½¿ç”¨â€ çš„ç« èŠ‚å½“ä¸­æˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°æ˜¯ç”¨æ¥åˆ›å»º Pinia æ•°æ®ä»“åº“æ¨¡å—ã€‚æ¥ä¸‹æ¥è¿™ä¸ªç« èŠ‚æˆ‘ä»¬ä¾¿è¦æ¥å¯¹è¯¥æ–¹æ³•è¿›è¡ŒåŸç†æ€§çš„è§£å‰–åˆ†æã€‚</p><p>defineStore æœ‰ä¼ å…¥ä¸‰ç§çš„å½¢å¼çš„å‚æ•°çš„è°ƒç”¨æ–¹å¼ï¼šï¼ˆåˆ©ç”¨ TypeScript å‡½æ•°é‡è½½æ¥å®ç°ä¼ é€’ä¸åŒå‚æ•°è¿›è¡Œæ•°æ®ä»“åº“çš„åˆå§‹åŒ–å¤„ç†ï¼‰</p><ul><li>idï¼šå®šä¹‰ store çš„å”¯ä¸€ idï¼Œå•ç‹¬ä¼ å‚æˆ–è€…é€šè¿‡ options.id è¿›è¡Œå£°æ˜</li><li>optionsï¼šå…·ä½“é…ç½®ä¿¡æ¯ï¼Œæ˜¯å¯¹è±¡å¯ä»¥ä¼  stateï¼Œgettersï¼Œactionï¼Œid å±æ€§ä¾‹å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„ç¬¬ä¸€ã€äºŒç§å£°æ˜æ–¹å¼ï¼›å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯ Functionï¼Œåˆ™è‡ªä¸»å£°æ˜å˜é‡æ–¹æ³•ï¼Œä¾‹å¦‚ä¾‹å­ä¸­çš„ç¬¬ä¸‰ç§å£°æ˜æ–¹å¼ï¼›</li><li>storeSetupï¼šä»…é™ç¬¬ä¸‰ç§ store çš„å£°æ˜æ–¹å¼ï¼Œä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºæ•°æ®ä»“åº“çš„ state ä¸ actions</li></ul><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vuejs:pinia/packages/pinia/src/store.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">idOrOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">setupOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> options</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DefineStoreOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_GettersTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_ActionsTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DefineSetupStoreOptions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_GettersTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StateTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_ActionsTree</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦æ˜¯å‡½æ•°</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> isSetupStore</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;function&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å…¼å®¹å¤„ç†ä¸‰ç§ä¸åŒå‚æ•°é‡è½½çš„æƒ…å†µï¼Œä»ä¸‰ç§å½¢å¼å‚æ•°å½“ä¸­æŠ½å–å‡º id ä¸ options å‚æ•°ï¼›</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  //   id åç»­ä¼šä½œä¸ºå½“å‰è¯¥ store çš„æ¨¡å—æ ‡è¯† id</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idOrOptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;string&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idOrOptions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isSetupStore </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setupOptions </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idOrOptions</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> idOrOptions.id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // å£°æ˜ useStore å‡½æ•°å¹¶ä¸”ä½œä¸º defineStore å‡½æ•°çš„è¿”å›å€¼</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreGeneric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreGeneric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Â·Â·Â· Â·Â·Â·</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  useStore.$id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> useStore</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>é€šè¿‡å¯¹ defineStore çš„æºç å¤§è‡´é€»è¾‘æµç¨‹åˆ†æå¯ä»¥å¾—çŸ¥ï¼ŒdefineStore é‡Œé¢å«æœ‰ä¸€ä¸ª useStore æ–¹æ³•ï¼Œå¹¶ä¸” defineStore å‡½æ•°çš„è¿”å›å€¼ä¸ºè¯¥ useStore å‡½æ•°ã€‚å› æ­¤ useStore æ‰æ˜¯ Pinia store æ•°æ®ä»“åº“çš„æ ¸å¿ƒåˆ›å»ºé€»è¾‘ï¼Œæ¥ä¸‹æˆ‘ä»¬é‡ç‚¹åˆ†æå…¶å‡½æ•°é€»è¾‘ã€‚</p><h3 id="usestore" tabindex="-1">useStore <a class="header-anchor" href="#usestore" aria-label="Permalink to &quot;useStore&quot;">â€‹</a></h3><div class="language-ts vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// vuejs:pinia/packages/pinia/src/store.ts</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">idOrOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">setupOptions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Â·Â·Â· Â·Â·Â·</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> useStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Pinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">hot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreGeneric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreGeneric</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // é€šè¿‡ getCurrentInstance è·å–å½“å‰ Vue çš„ç»„ä»¶å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> currentInstance</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getCurrentInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pinia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (__TEST__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activePinia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activePinia._testing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pinia) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">||</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (currentInstance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(piniaSymbol, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è®¾ç½®å½“å‰ Pinia æ´»è·ƒçš„ state å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (pinia) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setActivePinia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(pinia)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å¼€å‘æ¨¡å¼ä¸‹å¹¶ä¸”å½“å‰æ²¡æœ‰ pinia ä»“åº“æ•°æ® state å®ä¾‹æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (__DEV__ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">activePinia) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        \`[ğŸ]: getActivePinia was called with no active Pinia. Did you forget to install pinia?</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          \`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">const pinia = createPinia()</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          \`</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">app.use(pinia)</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">          \`This will fail in production.\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // è®¾ç½®å½“å‰ pinia å˜é‡å€¼ä¸ºå½“å‰æ´»è·ƒçš„ pinia state å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pinia </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activePinia</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // å•ä¾‹æ¨¡å¼çš„åº”ç”¨ï¼šå¦‚æœ pinia ä¸­å·²ç»æœ‰å¯¹åº” id æ¨¡å—çš„ store å®ä¾‹åˆ™ç›´æ¥è·å–è¯¥ store å®ä¾‹è¿”å›ï¼Œå¦åˆ™æ‰§è¡Œåˆ›å»º store é€»è¾‘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pinia._s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">has</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id)) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // æ ¹æ® defineStore æ—¶å€™ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ç±»å‹åŒºåˆ†è°ƒç”¨åˆ›å»º pinia store æ•°æ®ä»“åº“æ–¹æ³•</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // è‹¥ç¬¬äºŒä¸ªå‚æ•°ä¼ é€’çš„æ˜¯å‡½æ•°åˆ™æ‰§è¡Œ createSetupStoreï¼Œå¦åˆ™æ‰§è¡Œ createOptionsStore</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (isSetupStore) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        createSetupStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id, setup, options, pinia)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        createOptionsStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id, options </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, pinia)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> store</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StoreGeneric</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pinia._s.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // StoreGeneric cannot be casted towards Store</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> store </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  useStore.$id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> id</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> useStore</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>useStore çš„é€»è¾‘ä¸éš¾ï¼Œå°±æ˜¯è·å–å½“å‰ id çš„ pinia store å®ä¾‹ï¼Œè¿™é‡Œä½¿ç”¨å•ä¾‹æ¨¡å¼è¿›è¡Œä¼˜åŒ–ï¼š</p><p>å¦‚æœ pinia ä¸­å·²ç»æœ‰å¯¹åº” id æ¨¡å—çš„ store å®ä¾‹åˆ™ç›´æ¥è·å–è¯¥ store å®ä¾‹è¿”å›ï¼›</p><p>å‰é¢åœ¨ createStore æ–¹æ³•ç« èŠ‚å½“ä¸­è§£æäº†å½“å‰ pinia å¯¹è±¡çš„ _s å±æ€§æ˜¯ Map çš„æ•°æ®ç»“æ„å¯¹ Pinia æ‰€æœ‰æ¨¡å— store çš„å­˜å‚¨ï¼Œå› æ­¤æ­¤å¤„ä½¿ç”¨ Map çš„ get(key)æ–¹æ³•è·å–å½“å‰ id å¯¹åº”çš„æ¨¡å— store å®ä¾‹ï¼›</p><p>å¦åˆ™æ ¹æ®å‰é¢ defineStore è°ƒç”¨æ—¶å€™ä¼ é€’çš„å‚æ•°è¿›è¡ŒåŒºåˆ†è°ƒç”¨ createOptionsStore ä¸ createSetupStore ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h2 id="æµç¨‹æ€»ç»“" tabindex="-1">æµç¨‹æ€»ç»“ <a class="header-anchor" href="#æµç¨‹æ€»ç»“" aria-label="Permalink to &quot;æµç¨‹æ€»ç»“&quot;">â€‹</a></h2><ul><li>é€šè¿‡ createPinia åˆ›å»º pinia ç¤ºä¾‹ï¼Œå¹¶ä¸”åœ¨ app.use æ—¶æ‰§è¡Œ pinia å†…éƒ¨çš„ install æ–¹æ³• <ul><li>å…¶ä¸­ install æ–¹æ³•å½“ä¸­ä¼šä½¿ç”¨ Vue.js çš„ provide å°†å½“å‰ pinia ç¤ºä¾‹æ³¨å…¥åˆ°æ¯ä¸€ä¸ª Vue ç»„ä»¶å®ä¾‹ä¸­</li></ul></li><li>å½“ä¸šåŠ¡ä¸­ä½¿ç”¨ useXxx æ—¶å…¶å®å°±æ˜¯è°ƒç”¨ defineStore æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šæœ‰åœ¨çœŸæ­£è°ƒç”¨æ—¶æ‰ä¼šåˆå§‹åŒ–åˆ›å»ºå¯¹åº”æ¨¡å—çš„æ•°æ®ä»“åº“ï¼Œå…¶å†…éƒ¨å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š <ul><li>åˆ›å»ºä¸€ä¸ª store å¯¹è±¡ï¼Œå°† options çš„å„ä¸ªå±æ€§ stateã€getters åˆ©ç”¨ Vue.js å“åº”å¼ Composizion API è¿›è¡Œå¤„ç†å’Œè½¬æ¢</li><li>ä½¿ä¹‹æˆä¸ºå“åº”å¼æ•°æ®åï¼ŒæŒ‚è½½åœ¨è¿™ä¸ª store å¯¹è±¡ä¸Š</li><li>é€šè¿‡ Object.assign æ–¹æ³•å¯¹è¿™ä¸ª store å¯¹è±¡è¿›è¡Œ API æ‰©å±•ï¼ˆå¦‚ resetã€$patch ç­‰ï¼‰</li><li>å°† pinia çš„æ’ä»¶åœ¨è¿™ä¸ªæ¨¡å—åŒ–çš„ store ä¸Šåˆå§‹åŒ–åŠ è½½</li><li>è¿”å›è¿™ä¸ª store å¯¹è±¡ä½œä¸º defineStore æ–¹æ³•çš„è¿”å›å€¼</li></ul></li><li>è‡³æ­¤ pinia è¿™ä¸ªå…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·çš„å¼•å…¥å’Œæ¨¡å—åŒ–æ•°æ®ä»“åº“ store çš„åˆå§‹åŒ–æµç¨‹å°±å®Œæˆäº†</li></ul><h2 id="å‚è€ƒ" tabindex="-1">å‚è€ƒ <a class="header-anchor" href="#å‚è€ƒ" aria-label="Permalink to &quot;å‚è€ƒ&quot;">â€‹</a></h2><p><a href="https://juejin.cn/post/7210175991837736997" target="_blank" rel="noreferrer">Pinia åŸç†è§£è¯» - åˆå§‹åŒ–æµç¨‹ä¸æ•°æ®ä»“åº“çš„å®ç°</a></p>`,34),e=[l];function h(t,k,r,E,d,g){return a(),i("div",null,e)}const F=s(p,[["render",h]]);export{c as __pageData,F as default};
